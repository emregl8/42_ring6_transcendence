apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-token-renew-script
  namespace: transcendence
data:
  renew-token.sh: |
    #!/bin/sh
    set -e

    if [ -z "$VAULT_TOKEN" ]; then
        echo "ERROR: VAULT_TOKEN environment variable is not set"
        exit 1
    fi

    echo "Checking token status..."

    if ! vault token lookup >/dev/null 2>&1; then
        echo "ERROR: Token is invalid or expired!"
        exit 1
    fi

    echo "Token is valid"

    echo "Renewing token..."
    if ! vault token renew >/dev/null 2>&1; then
        echo "ERROR: Failed to renew token!"
        exit 1
    fi

    echo "Token renewed successfully!"
